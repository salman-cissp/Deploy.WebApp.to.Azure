
![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/baf3b50a-dbb9-4057-a29d-38372a8d1ea6)
![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/6ce2d7e7-fda4-47a3-a23e-0e53521649e4)


Instead of activating function though http trigger(public & synchronous), we use Event Grid(much safer & asynchronous) 
- Event Grid |System Topics
	- create
		- ``orders-topic``<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/2df33c04-8260-4507-be96-d876f29ea521)

		- in ``order`` app replace ``ProcessOrderCosmos.cs`` with new one which supports event grid
		- add event grid support<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/e2774939-222f-4818-bd7b-545d38015c08)

		- get connection string from ``ordersreadit0523`` storage account<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/80ec3982-a8e4-44d4-b5ff-45808e8c9415)

		- paste it in ``local.settings.json``<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/b075bfc3-9b1d-4250-8ce6-34fc69d7cb71)

		- copy connection string from ``readitfuncstorage0523`` storage account and paste into new entry in ``local.settings.json`` <br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/9c76e6d8-eafe-417c-8c28-c41c40ef21ef)

		- deploy this function to ``readitfunctionapp0523``<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/9d17f005-a470-4be6-b2e8-f3dc1b98d020)

		- upload settings<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/7c4cd58f-3193-4775-a8c8-b7777893d519)

		- create event subscription & select our function as subscription to this topic
			- whenever event in storage account occurs, our function is going to trigger<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/67ff4eb9-7c9f-43f4-a6a2-2de6de486811)

		- test
			- upload blob in storage account<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/2be6859b-7337-4044-878e-89c89dd7254f)

			 
		- connect cart app to storage account so that when placing order the order will be saved in the storage account
			- replace ``index.cshtml.cs`` with new one in the cart app
			- we dont need OrderFuntionUrl anymore<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/59bf7360-94bd-41f1-a852-8601b0784901)

			- replace it with storage account connection string<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/8c12a9e0-17cd-4a83-a125-804044d2b2ee)

			- build<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/2c130557-a017-4e21-8213-b5138aea86eb)

			- test locally
			- open catalog, add 2 books<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/b43e566e-f0a8-45fe-94f2-9448e156fdc6)

			- check cart<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/50220b47-1ddd-44bd-9fb3-d6897b87539e)

			- place order<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/7064677a-22e1-456e-8115-9192b0eea164)

			- order is received<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/37c98ad3-2a46-4ea0-ac42-1dee87f6d117)

			- function received the order<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/29756d09-6423-4d6f-96d4-0ef0b0f9199e)


			- order received in cosmos db<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/39f1fbca-1e87-4a45-8bf3-ad81f6d53386)
		- publish cart app to AKS
			- build docker image in VS Code
			- push image to ACR as ver 1
			- update deployment.yaml with ver 1
			- deploy to AKS
			- test
				- add one book<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/950477aa-5354-47fc-b3cc-25cf3885985d)

				- check the cart<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/7dbfd2dd-25f5-48e0-bca2-5a0af8db6dd1)

				- place order<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/d889b344-609b-40d8-87db-3c104971bf26)

				- check neworders<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/55b27420-0d11-48ad-aaa8-5f7cc317084c)

				- check function<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/ff3ac111-baf7-48a6-a000-13294d72b93f)

				- check cosmos db<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/8dc3d8a5-368e-4bbd-80b1-4594d5422765)

			- everything works fine
- Protecting the function (publicly available)
	- allow only from event grid<br>![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/59d41422-459e-4d7b-a9b4-ed9e563884fd)

 


![download](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/3ca1f14e-28e8-44a7-9fe3-a042848d30b4)

