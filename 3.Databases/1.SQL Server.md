# 1.Setting up the SQL Server
- create new sql db ``readitdbserver-s
- enable public access 
- Connect to catalog app
	- add the db connection string in appsettings.json<br>
	 ![Pasted image 20230513140436](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/11096b25-767c-4652-9136-53d64b7ba10f)

	- disable in-memory db<br>
	 ![Pasted image 20230513140540](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/fd50e0bd-d9a7-487b-b834-174575c1919c)

	- create table<br>
	 ![Pasted image 20230513140917](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/7363b9c4-ca48-4663-afac-af57d4a776b3)

	 - create this table in azure database<br>
	 ![Pasted image 20230513141158](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/9160903c-003d-4c7d-875f-2d3bc805ce82)
	 - Books table created<br>
	 ![Pasted image 20230513141436](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/8c8c8520-96c0-4744-9071-12a9adfd7a6b)

	 - build code locally, add books to db<br>
	 ![Pasted image 20230513141719](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/40023bc8-787b-48fd-892f-36ade839516c)


	 - check if records were added<br>
	 ![Pasted image 20230513141817](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/f3f08679-50a8-486c-a2af-acfc3881a653)
	 ![Pasted image 20230513141817](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/53a54bd3-81a0-40c1-bc70-03d8139b3b00)

	 - this means catalog app is working and successfully connecting to azure db
	 - publish it again
		 - stop web server
		 - copy the contents of publish folder to web server
		 - start web server
	 - connect to catalog via the app gateway public on port 8080
	 - wont be able to connect<br>
	 ![Pasted image 20230513201220](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/52cbf2b6-7298-4e11-86b7-6369c4b57b25)

	 - add public ip of catalog-vm pip to the firewall rule in sql database server<br>
  	 ![Pasted image 20230513201843](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/2c6aac1b-ca68-43c6-b460-2cf4179303d6)

	 - should work now<br>	 
	 ![Pasted image 20230513202533](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/4b15da43-6257-4d3f-8b66-c6a24231c910)

	 - another another layer of security by setting service end point between the db and catalog vm
		 - ``readit-app-vnet`` to ``default`` subnet of ``catalog-vm``<br>
		 ![Pasted image 20230513202955](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/22b631bc-156e-43e0-92df-8ffcf2f10219)
		 
		 - in db, add existing vnet in firewall<br>
		 ![Pasted image 20230513203206](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/97e5d26d-52e3-4526-a040-b76de4684e0a)
		 ![Pasted image 20230513203226](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/e93aca77-ac63-417e-97e8-b446e376efbc)

		 - previous catalog-vm rule can now be removed<br>
		 ![Pasted image 20230513203343](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/b98993be-2381-4714-9300-cbf378ec0658)

		 - make sure catalog-vm can still connect to the db(using service-endpoints)<br>
	  	 ![Pasted image 20230513203508](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/d391b151-fc7a-400d-8c2c-a412b5f01b98)

	 
- Connecting Inventory to DB
	- inventory code in VS Code
		- uncomment<br>
	![Pasted image 20230514110559](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/322d048d-a45d-4d2c-9174-5edd558aed07)

		- deploy and publish to web<br>
	![Pasted image 20230514110825](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/a7ab81b2-0a55-4689-8db1-d9f597dd580c)
![Pasted image 20230514110918](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/f73ebc4e-a6cf-456b-8441-cafdbb3d6c4d)

	
		- check inventory app @ ``https://readit-inventory-s.azurewebsites.net/<br>
	![Pasted image 20230514111234](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/defc833c-5ec2-4d3c-9512-c1655b44c607)

		- this errror is because of this:<br>
	![Pasted image 20230514111355](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/e5625555-f143-410a-92ce-56fbf8c458d7)

		- we need to add the connection string to the web app, but not in the code<br>
	![Pasted image 20230514111631](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/252144d6-4109-48fc-8916-151a442bd917)

		- now we get this error<br>
	![Pasted image 20230514111748](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/54973323-cf0b-4ca5-9dbf-49cb0a8f97e6)

		- add the ip address to db firewall<br>
	![Pasted image 20230514111906](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/c377b12f-a0c1-4925-be99-e53c78206e80)

		- test it works<br>
![Pasted image 20230514111958](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/1876c247-4d16-4fb0-b071-699612f6d5e8)

		- change stock of one book<br>
![Pasted image 20230514112341](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/aff34f0a-1527-4dab-b5f1-035fa13bc4a0)

		- test if catalog updates<br>
![Pasted image 20230514112416](https://github.com/salman-cissp/Deploy.WebApp.to.Azure/assets/134168108/d19bcd61-cc2b-4da4-8412-8cb488ab53df)

		- means both inventory & catalog are connected to the same azure sql db  and working fine<br>
